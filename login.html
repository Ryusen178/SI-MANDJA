<button class="btn-submit" onclick="login()">Login</button>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const SUPABASE_URL = "https://utsyujgdlahuegjwpiab.supabase.co";
  const SUPABASE_KEY =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV0c3l1amdkbGFodWVnandwaWFiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyOTMzOTMsImV4cCI6MjA3Mzg2OTM5M30.mNNJOlgYdYIYarrbu8CLALqQrfVEWd9eDZp1MN_x-Ls";

  const supa = createClient(SUPABASE_URL, SUPABASE_KEY);

  async function login() {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!email || !password) {
      alert("Email dan password wajib diisi.");
      return;
    }

    // Login user
    const { data, error } = await supa.auth.signInWithPassword({ email, password });
    if (error) {
      alert("Login gagal: " + error.message);
      return;
    }

    // Ambil role dari tabel profiles
    const { data: profile, error: profileError } = await supa
      .from("profiles")
      .select("role")
      .eq("id", data.user.id)
      .maybeSingle();

    if (profileError) {
      alert("Gagal mengambil data profile: " + profileError.message);
      return;
    }

    if (!profile) {
      alert("Profil tidak ditemukan. Hubungi admin.");
      return;
    }

    // Simpan role ke localStorage
    localStorage.setItem("role", profile.role);

    // Redirect ke dashboard (semua role)
    window.location.href = "dashboard.html";
  }

  // supaya bisa dipanggil onclick
  window.login = login;
</script>




